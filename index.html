<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pixel Pirate Plunder</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a2e;
            overflow: hidden;
            touch-action: manipulation;
            font-family: 'Courier New', monospace;
            user-select: none;
            -webkit-user-select: none;
        }
        
        #gameCanvas {
            display: block;
            background: linear-gradient(to bottom, #0f0c29, #302b63);
            margin: 0 auto;
            image-rendering: pixelated;
        }
        
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #fff;
            font-size: 18px;
            text-shadow: 2px 2px 2px #000;
        }
        
        #controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
        }
        
        .btn {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #fff;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: manipulation;
        }
        
        #titleScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #0f0c29, #302b63);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        #title {
            font-size: 48px;
            color: #f8c537;
            text-shadow: 4px 4px 0 #a82b2b;
            margin-bottom: 20px;
        }
        
        #startBtn {
            background: #f8c537;
            color: #1a1a2e;
            border: none;
            padding: 15px 30px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
        }
        
        #deathScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: #f8c537;
        }
        
        #deathTitle {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        #restartBtn {
            background: #f8c537;
            color: #1a1a2e;
            border: none;
            padding: 15px 30px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="ui">
        <div>Gold: <span id="gold">0</span></div>
        <div>Health: <span id="health">100</span></div>
    </div>
    
    <div id="controls">
        <div class="btn" id="leftBtn">←</div>
        <div class="btn" id="jumpBtn">↑</div>
        <div class="btn" id="attackBtn">⚔</div>
        <div class="btn" id="rightBtn">→</div>
    </div>
    
    <div id="titleScreen">
        <div id="title">PIXEL PIRATE PLUNDER</div>
        <button id="startBtn">START ADVENTURE</button>
    </div>
    
    <div id="deathScreen">
        <div id="deathTitle">YARR, YE BE SUNK!</div>
        <div id="deathStats"></div>
        <button id="restartBtn">SAIL AGAIN</button>
    </div>

    <script>
        // Game Constants
        const GRAVITY = 0.5;
        const FRICTION = 0.9;
        const PLAYER_SPEED = 5;
        const JUMP_FORCE = -12;
        
        // Game State
        const game = {
            player: {
                x: 100,
                y: 300,
                width: 32,
                height: 48,
                velX: 0,
                velY: 0,
                health: 100,
                maxHealth: 100,
                gold: 0,
                isJumping: false,
                isAttacking: false,
                attackCooldown: 0,
                facing: 'right'
            },
            camera: {
                x: 0,
                y: 0
            },
            platforms: [],
            enemies: [],
            treasures: [],
            particles: [],
            isRunning: false,
            isGameOver: false,
            keys: {
                left: false,
                right: false,
                up: false,
                attack: false
            },
            worldWidth: 3000,
            worldHeight: 800
        };
        
        // Canvas Setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // UI Elements
        const goldDisplay = document.getElementById('gold');
        const healthDisplay = document.getElementById('health');
        const titleScreen = document.getElementById('titleScreen');
        const deathScreen = document.getElementById('deathScreen');
        const deathStats = document.getElementById('deathStats');
        
        // Controls
        document.getElementById('leftBtn').addEventListener('touchstart', () => game.keys.left = true);
        document.getElementById('leftBtn').addEventListener('touchend', () => game.keys.left = false);
        document.getElementById('rightBtn').addEventListener('touchstart', () => game.keys.right = true);
        document.getElementById('rightBtn').addEventListener('touchend', () => game.keys.right = false);
        document.getElementById('jumpBtn').addEventListener('touchstart', () => game.keys.up = true);
        document.getElementById('jumpBtn').addEventListener('touchend', () => game.keys.up = false);
        document.getElementById('attackBtn').addEventListener('touchstart', () => game.keys.attack = true);
        
        // Keyboard Controls
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') game.keys.left = true;
            if (e.key === 'ArrowRight') game.keys.right = true;
            if (e.key === 'ArrowUp') game.keys.up = true;
            if (e.key === ' ') game.keys.attack = true;
        });
        
        document.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft') game.keys.left = false;
            if (e.key === 'ArrowRight') game.keys.right = false;
            if (e.key === 'ArrowUp') game.keys.up = false;
            if (e.key === ' ') game.keys.attack = false;
        });
        
        // Game Start/Restart
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('restartBtn').addEventListener('click', startGame);
        
        // Game Functions
        function startGame() {
            titleScreen.style.display = 'none';
            deathScreen.style.display = 'none';
            
            // Reset Game State
            game.player = {
                x: 100,
                y: 300,
                width: 32,
                height: 48,
                velX: 0,
                velY: 0,
                health: 100,
                maxHealth: 100,
                gold: 0,
                isJumping: false,
                isAttacking: false,
                attackCooldown: 0,
                facing: 'right'
            };
            
            game.camera = { x: 0, y: 0 };
            game.platforms = [];
            game.enemies = [];
            game.treasures = [];
            game.particles = [];
            game.isRunning = true;
            game.isGameOver = false;
            
            // Generate World
            generateWorld();
            
            // Update UI
            updateUI();
            
            // Start Game Loop
            requestAnimationFrame(gameLoop);
        }
        
        function generateWorld() {
            // Ground
            game.platforms.push({ x: 0, y: 600, width: game.worldWidth, height: 50 });
            
            // Platforms
            for (let i = 0; i < 20; i++) {
                game.platforms.push({
                    x: Math.random() * game.worldWidth,
                    y: 400 + Math.random() * 150,
                    width: 80 + Math.random() * 100,
                    height: 20
                });
            }
            
            // Caves (treasure spots)
            for (let i = 0; i < 10; i++) {
                game.platforms.push({
                    x: 200 + i * 300,
                    y: 550,
                    width: 60,
                    height: 50,
                    isCave: true
                });
            }
            
            // Treasures
            for (let i = 0; i < 15; i++) {
                game.treasures.push({
                    x: 100 + Math.random() * (game.worldWidth - 200),
                    y: 300 + Math.random() * 200,
                    width: 20,
                    height: 20,
                    value: 10 + Math.floor(Math.random() * 40)
                });
            }
            
            // Enemies
            for (let i = 0; i < 10; i++) {
                game.enemies.push({
                    x: 200 + Math.random() * (game.worldWidth - 400),
                    y: 550,
                    width: 32,
                    height: 48,
                    velX: Math.random() > 0.5 ? 1 : -1,
                    health: 30,
                    type: 'skeleton'
                });
            }
        }
        
        function update() {
            // Player Movement
            if (game.keys.left) {
                game.player.velX = -PLAYER_SPEED;
                game.player.facing = 'left';
            } else if (game.keys.right) {
                game.player.velX = PLAYER_SPEED;
                game.player.facing = 'right';
            } else {
                game.player.velX *= FRICTION;
            }
            
            // Jumping
            if (game.keys.up && !game.player.isJumping) {
                game.player.velY = JUMP_FORCE;
                game.player.isJumping = true;
                createParticles(game.player.x + game.player.width/2, game.player.y + game.player.height, 10, '#f8c537');
            }
            
            // Gravity
            game.player.velY += GRAVITY;
            
            // Update Position
            game.player.x += game.player.velX;
            game.player.y += game.player.velY;
            
            // Camera Follow
            game.camera.x = game.player.x - canvas.width/3;
            game.camera.y = game.player.y - canvas.height/2;
            
            // Boundary Checks
            if (game.player.x < 0) game.player.x = 0;
            if (game.player.x > game.worldWidth - game.player.width) game.player.x = game.worldWidth - game.player.width;
            if (game.player.y > game.worldHeight - game.player.height) {
                game.player.y = game.worldHeight - game.player.height;
                game.player.velY = 0;
                game.player.isJumping = false;
            }
            
            // Platform Collisions
            let onGround = false;
            game.platforms.forEach(platform => {
                if (collision(game.player, platform)) {
                    // Top collision
                    if (game.player.velY > 0 && game.player.y + game.player.height < platform.y + 10) {
                        game.player.y = platform.y - game.player.height;
                        game.player.velY = 0;
                        game.player.isJumping = false;
                        onGround = true;
                    }
                }
            });
            
            if (!onGround) game.player.isJumping = true;
            
            // Attack
            if (game.keys.attack && game.player.attackCooldown <= 0) {
                game.player.isAttacking = true;
                game.player.attackCooldown = 20;
                
                // Check enemy hits
                game.enemies.forEach(enemy => {
                    const attackRange = {
                        x: game.player.facing === 'right' ? game.player.x + game.player.width : game.player.x - 40,
                        y: game.player.y,
                        width: 40,
                        height: game.player.height
                    };
                    
                    if (collision(attackRange, enemy)) {
                        enemy.health -= 25;
                        createParticles(enemy.x + enemy.width/2, enemy.y + enemy.height/2, 15, '#ff0000');
                        
                        if (enemy.health <= 0) {
                            // Drop gold
                            game.treasures.push({
                                x: enemy.x,
                                y: enemy.y,
                                width: 15,
                                height: 15,
                                value: 5 + Math.floor(Math.random() * 15)
                            });
                        }
                    }
                });
                
                createParticles(
                    game.player.facing === 'right' ? game.player.x + game.player.width : game.player.x - 10,
                    game.player.y + game.player.height/2,
                    8, '#ffffff'
                );
            }
            
            if (game.player.attackCooldown > 0) {
                game.player.attackCooldown--;
            } else {
                game.player.isAttacking = false;
            }
            
            // Enemy AI
            game.enemies = game.enemies.filter(enemy => enemy.health > 0);
            game.enemies.forEach(enemy => {
                enemy.x += enemy.velX;
                
                // Simple patrol
                let onEdge = true;
                game.platforms.forEach(platform => {
                    if (enemy.x + enemy.width > platform.x && enemy.x < platform.x + platform.width &&
                        enemy.y + enemy.height <= platform.y + 5 && enemy.y + enemy.height >= platform.y - 5) {
                        onEdge = false;
                    }
                });
                
                if (onEdge) enemy.velX *= -1;
                
                // Damage player if touching
                if (collision(game.player, enemy)) {
                    game.player.health -= 0.5;
                    if (game.player.health <= 0) gameOver();
                }
            });
            
            // Treasure Collection
            game.treasures = game.treasures.filter(treasure => {
                if (collision(game.player, treasure)) {
                    game.player.gold += treasure.value;
                    createParticles(treasure.x + treasure.width/2, treasure.y + treasure.height/2, 10, '#f8c537');
                    updateUI();
                    return false;
                }
                return true;
            });
            
            // Update Particles
            game.particles.forEach(p => {
                p.x += p.velX;
                p.y += p.velY;
                p.life--;
            });
            game.particles = game.particles.filter(p => p.life > 0);
        }
        
        function render() {
            // Clear Canvas
            ctx.fillStyle = '#0f0c29';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw Parallax Background
            drawBackground();
            
            // Draw World (offset by camera)
            ctx.save();
            ctx.translate(-game.camera.x, -game.camera.y);
            
            // Draw Platforms
            game.platforms.forEach(platform => {
                if (platform.isCave) {
                    // Cave entrance
                    ctx.fillStyle = '#3a2c1a';
                    ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                    
                    // Cave interior shadow
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.beginPath();
                    ctx.arc(platform.x + platform.width/2, platform.y + 10, platform.width/2 - 5, 0, Math.PI, true);
                    ctx.fill();
                } else {
                    // Regular platform
                    ctx.fillStyle = '#5d4037';
                    ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                    
                    // Platform detail
                    ctx.fillStyle = '#3e2723';
                    for (let i = 0; i < platform.width; i += 10) {
                        ctx.fillRect(platform.x + i, platform.y, 5, 3);
                    }
                }
            });
            
            // Draw Treasures
            game.treasures.forEach(treasure => {
                ctx.fillStyle = '#f8c537';
                ctx.fillRect(treasure.x, treasure.y, treasure.width, treasure.height);
                
                // Shine effect
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.beginPath();
                ctx.moveTo(treasure.x + 5, treasure.y + 5);
                ctx.lineTo(treasure.x + 15, treasure.y + 5);
                ctx.lineTo(treasure.x + 5, treasure.y + 15);
                ctx.fill();
            });
            
            // Draw Enemies
            game.enemies.forEach(enemy => {
                // Body
                ctx.fillStyle = '#e0e0e0';
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                
                // Head
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(enemy.x + 8, enemy.y - 10, 16, 10);
                
                // Eyes
                ctx.fillStyle = '#000000';
                ctx.fillRect(enemy.x + 12, enemy.y - 7, 4, 4);
                ctx.fillRect(enemy.x + 20, enemy.y - 7, 4, 4);
                
                // Health bar
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(enemy.x, enemy.y - 15, enemy.width, 3);
                ctx.fillStyle = '#00ff00';
                ctx.fillRect(enemy.x, enemy.y - 15, enemy.width * (enemy.health / 30), 3);
            });
            
            // Draw Player
            ctx.fillStyle = '#8d6e63'; // Coat
            ctx.fillRect(game.player.x, game.player.y, game.player.width, game.player.height);
            
            // Head
            ctx.fillStyle = '#ffdbac';
            ctx.fillRect(game.player.x + 8, game.player.y - 10, 16, 10);
            
            // Hat
            ctx.fillStyle = '#a82b2b';
            ctx.fillRect(game.player.x + 4, game.player.y - 15, 24, 5);
            ctx.fillRect(game.player.x + 12, game.player.y - 25, 8, 10);
            
            // Eye patch
            if (game.player.facing === 'right') {
                ctx.fillStyle = '#000000';
                ctx.fillRect(game.player.x + 12, game.player.y - 7, 6, 3);
            } else {
                ctx.fillStyle = '#000000';
                ctx.fillRect(game.player.x + 18, game.player.y - 7, 6, 3);
            }
            
            // Sword when attacking
            if (game.player.isAttacking) {
                ctx.fillStyle = '#cccccc';
                if (game.player.facing === 'right') {
                    ctx.fillRect(game.player.x + game.player.width, game.player.y + 10, 30, 5);
                } else {
                    ctx.fillRect(game.player.x - 30, game.player.y + 10, 30, 5);
                }
            }
            
            // Draw Particles
            game.particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life / p.maxLife;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            });
            ctx.globalAlpha = 1;
            
            ctx.restore();
        }
        
        function drawBackground() {
            // Stars
            ctx.fillStyle = '#ffffff';
            for (let i = 0; i < 100; i++) {
                const x = (i * 50 + game.camera.x * 0.1) % canvas.width;
                const y = (i * 37) % canvas.height;
                const size = 1 + Math.random();
                ctx.fillRect(x, y, size, size);
            }
            
            // Moon
            ctx.fillStyle = '#f5f5f5';
            ctx.beginPath();
            ctx.arc(canvas.width - 100 - game.camera.x * 0.05, 100, 30, 0, Math.PI * 2);
            ctx.fill();
            
            // Mountains
            ctx.fillStyle = '#1b5e20';
            ctx.beginPath();
            ctx.moveTo(0 - game.camera.x * 0.2, canvas.height);
            ctx.lineTo(0 - game.camera.x * 0.2, canvas.height - 100);
            ctx.lineTo(200 - game.camera.x * 0.2, canvas.height - 150);
            ctx.lineTo(400 - game.camera.x * 0.2, canvas.height - 120);
            ctx.lineTo(600 - game.camera.x * 0.2, canvas.height - 180);
            ctx.lineTo(800 - game.camera.x * 0.2, canvas.height - 100);
            ctx.lineTo(1000 - game.camera.x * 0.2, canvas.height - 140);
            ctx.lineTo(canvas.width, canvas.height);
            ctx.fill();
        }
        
        function createParticles(x, y, count, color) {
            for (let i = 0; i < count; i++) {
                game.particles.push({
                    x: x,
                    y: y,
                    size: 2 + Math.random() * 4,
                    velX: -2 + Math.random() * 4,
                    velY: -2 + Math.random() * 4,
                    color: color,
                    life: 10 + Math.random() * 20,
                    maxLife: 30
                });
            }
        }
        
        function collision(a, b) {
            return a.x < b.x + b.width &&
                   a.x + a.width > b.x &&
                   a.y < b.y + b.height &&
                   a.y + a.height > b.y;
        }
        
        function updateUI() {
            goldDisplay.textContent = game.player.gold;
            healthDisplay.textContent = Math.floor(game.player.health);
        }
        
        function gameOver() {
            game.isRunning = false;
            game.isGameOver = true;
            deathStats.innerHTML = `
                <div>Gold Collected: ${game.player.gold}</div>
                <div>Distance Traveled: ${Math.floor(game.player.x)}m</div>
            `;
            deathScreen.style.display = 'flex';
        }
        
        // Main Game Loop
        function gameLoop() {
            if (game.isRunning) {
                update();
                render();
                requestAnimationFrame(gameLoop);
            }
        }
    </script>
</body>
</html>
